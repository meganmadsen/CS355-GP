{% extends "base.html" %}

{% block content %}
  {# <form class="d-flex">
      <input type="text" class="form-control" placeholder="Search Jobs" style="width: 350px; margin-right: 5px;">
      <button type="submit" class="btn btn-primary" style="margin-right: 15px;"> Search</button>
  </form> #}
  <!-- This loops through the jobs and creates the following html for each job-->
  <div class="container">
    <h3>Jobs</h3>
    <hr>
    <div class="card-deck overflow-y-auto h-50">
      <div class="row w-100 gx-5">
      
      {% for job in jobs %} 
      {# <div class="col-lg-12 mb-5">
        <div class="card h-100 mx-auto w-75 shadow border-0">
            <img class="card-img-top" style="max-height:250px;" src={{ job['img_path']}} alt="...">
            <div class="card-body p-4">
                <p id="jobId" hidden>{{ id }}</p>
                <div class="badge bg-primary bg-gradient rounded-pill mb-2">type</div>
                <a class="text-decoration-none link-dark stretched-link" href="#!"><h5 class="card-title mb-3">{{ job['job_title'] }}</h5></a>
                <p class="card-text mb-0">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
            </div>
            <div class="card-footer p-4 pt-0 bg-transparent border-top-0">
                <div class="d-flex align-items-end justify-content-between">
                    <div class="d-flex align-items-center">
                        <img class="rounded-circle me-3" src="https://dummyimage.com/40x40/ced4da/6c757d" alt="...">
                        <div class="small">
                            <div class="fw-bold">{{ job['first_n'] }}</div>
                            <div class="text-muted">Posted: {{ job['date_listed'].format() }}</div>
                        </div>
                        <button class="btn btn-primary apply mt-1 ms-4" data-bs-toggle="modal" data-bs-target="#apply-modal">Apply</button>  
                    </div>
                </div>
            </div>
        </div>
      </div> #}


 
        {% set id = job['job_id']|string %}
        {% set descripID = "descrip" ~ id %}
        <div class="card m-1 w-100 mx-auto shadow border-0" style="min-height: 125px;max-width: 100%;">
          <div class="row g-0 h-100">
            <div class="col-md-3">
              <img src="{{ job['img_path'] }}" class="img-fluid rounded-start" alt="" style="height: 200px; width: 100%; object-fit: fill;"> <!-- Optional image-->
            </div>
            <div class="col-md-7">
              <div class="card-body">            
                <h5 class="card-title fw-bold">Job Title:   </h5>
                <p id="jobId" hidden>{{ id }}</p>
                <p class="card-text">Posted by: {{ job['first_n'] }}</p>
                {% if job['dept_title'] != None %}
                  <p class="card-text">Department: <a href="department_profile{{ job['dept_title'] }}">{{ job['dept_title'] }}</a></p>              
                {% endif %}
              
                <p class="card-text"><small class="text-body-secondary">Posted: {{ job['date_listed'].format() }}</small></p>


              </div>          
            </div>
            <div class="col-md-2 flex-column d-flex">
            <button class="btn btn-primary apply mt-5 m-2" data-bs-toggle="modal" data-bs-target="#apply-modal">Apply</button>   <!-- Button trigger modal -->
            <button class="btn btn-secondary m-2" data-bs-toggle="collapse" data-bs-target="#{{ descripID }}" aria-expanded="false">See More</button>
          </div>
          <div class="row">
            <div class="collapse multi-collapse" id="{{ descripID }}">
              <p class="card-text">{{ job['job_descrip'] }}</p>
            </div>
          </div>            
        </div>
      </div>    
    {% endfor %}
    </div>
  </div>
</div>
  
  <!-- Modal -->
  <div class="modal fade" id="apply-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="jobTitle" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="jobTitle"></h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">          
          <p id="description" class="card-text"></p>
          <p class="card-text"><small id="date_listed" class="text-body-secondary"></small></p>          
          <button id="apply" class="btn btn-primary">Apply</button>
        </div>

      </div>
    </div>
  </div>
  

{% endblock %}

{% block script %}
<script>
  
  // document.querySelectorAll('.expand').forEach((btn) => {
  //   btn.addEventListener('click', (event) => {
  //     let card = event.target.parentElement.parentElement.parentElement;
  //     card.classList.toggle('expanded');
  //     let hiddenText = card.querySelector('.hidden-text');
  //     hiddenText.style.display = hiddenText.style.display === 'none' ? 'block' : 'none';
  //   });
  // });

  //Modal vars

  let jobId;
  let titleEle; 
  let descripEle;
  let dateListedEle;

  //Job Modal Event
  document.querySelectorAll('.btn.learnMore').forEach((btn) => {
    
    //Activate Job Modal
    btn.addEventListener('click', (event) => {

      jobId = event.target.parentElement.querySelector('#jobId').innerText

      titleEle = document.getElementById('jobTitle');
      descripEle = document.getElementById('description');
      dateListedEle = document.getElementById('date_listed');

      const req = new XMLHttpRequest();

      //populate the modal with the selected job info
      req.addEventListener("load", () => {
        let res = req.response;
        titleEle.innerText = res['title'];
        descripEle.innerText = res['descrip'];
        dateListedEle.innerText = res['date_listed'];

      });
      req.open("GET", "jobs/" + jobId);
      req.responseType = "json";
      req.send();

      //title = document.getElementById('staticBackdropLabel');
      //title.innerText = null
    });
  });
  //Apply
  document.querySelector('.apply').forEach((btn) => {
    btn.addEventListener('click', (event) => {
      const req = new XMLHttpRequest();

      req.addEventListener("load", () => {
        let res = req.response;

      });
      req.open('GET', 'jobs/' + jobId + '/apply');
      req.responseType = 'json';
      req.send();
    });
  });
</script>
{% endblock %}